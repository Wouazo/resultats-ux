
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Résultats de votre évaluation UX</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: auto;
        }
        h1 {
            font-size: 2.5em;
            font-weight: bold;
        }
        .lvl-score {
            font-weight: bold;
        }
        .btn-download {
            display: inline-block;
            margin-top: 20px;
            background-color: #15657A;
            color: white;
            text-decoration: none;
            padding: 10px 25px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        #logo {
            max-height: 60px;
            margin-bottom: 20px;
        }
        canvas {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <img src="https://uxlabtoolkit.ch/wp-content/uploads/2024/01/logo-UXLabToolkit.svg" alt="Logo" id="logo">
    <h1>Résultats de votre évaluation UX</h1>
    <div id="level-description"></div>
    <canvas id="radar-chart" width="600" height="600"></canvas>
    <button class="btn-download" id="download-pdf">→ Télécharger les résultats</button>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const get = key => parseInt(urlParams.get(key)) || 0;

        const scores = {
            SK: [get("SK1"), get("SK2"), get("SK3")],
            INV: [get("INV1"), get("INV2"), get("INV3")],
            INT: [get("INT1"), get("INT2"), get("INT3")],
            CLT: [get("CLT1"), get("CLT2"), get("CLT3")],
            ST: [get("ST1"), get("ST2")],
            INS: [get("INS1"), get("INS2")]
        };

        const weights = {
            SK: [0.5, 0.33, 0.17],
            INV: [0.5, 0.25, 0.25],
            INT: [0.5, 0.27, 0.23],
            CLT: [0.25, 0.25, 0.5],
            ST: [0.6, 0.4],
            INS: [0.5, 0.5]
        };

        const labels = [
            "Compétences UX",
            "Investissement UX",
            "Intégration UX",
            "Culture UX",
            "Stratégie UX",
            "Exploitation résultats UX"
        ];

        function weightedAverage(values, weights) {
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            const score = values.reduce((sum, val, i) => sum + val * weights[i], 0);
            return Math.round((score / totalWeight) * 100) / 100;
        }

        const dimensions = [
            weightedAverage(scores.SK, weights.SK),
            weightedAverage(scores.INV, weights.INV),
            weightedAverage(scores.INT, weights.INT),
            weightedAverage(scores.CLT, weights.CLT),
            weightedAverage(scores.ST, weights.ST),
            weightedAverage(scores.INS, weights.INS)
        ];

        const globalScore = Math.round(dimensions.reduce((a, b) => a + b, 0) / dimensions.length * 100) / 100;

        const descriptions = [
            {
                title: "Niveau 1 : Absent",
                min: 0,
                max: 0.99,
                desc: "L’UX est pour l'heure inexistant ou totalement ignoré dans l’organisation..."
            },
            {
                title: "Niveau 2 : Émergent",
                min: 1,
                max: 1.99,
                desc: "Quelques initiatives UX émergent, mais elles sont ponctuelles et non structurées..."
            },
            {
                title: "Niveau 3 : Structuré",
                min: 2,
                max: 2.99,
                desc: "L’UX est intégré dans certains processus et projets, avec des pratiques régulières..."
            },
            {
                title: "Niveau 4 : Intégré",
                min: 3,
                max: 3.99,
                desc: "L’UX est pleinement intégré aux processus de conception et aux décisions stratégiques..."
            },
            {
                title: "Niveau 5 : Optimisé",
                min: 4,
                max: 5,
                desc: "L’UX est un pilier stratégique et un moteur d’innovation..."
            }
        ];

        function getLevel(score) {
            return descriptions.find(l => score >= l.min && score <= l.max);
        }

        const level = getLevel(globalScore);
        document.getElementById("level-description").innerHTML = `<h2>${level.title}</h2><p class="lvl-score">Score global : ${globalScore}</p><p>${level.desc}</p>`;

        const ctx = document.getElementById("radar-chart");
        const radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    data: dimensions,
                    fill: true,
                    backgroundColor: "rgba(21, 101, 122, 0.2)",
                    borderColor: "#15657A",
                    pointBackgroundColor: "#15657A"
                }]
            },
            options: {
                responsive: false,
                scales: {
                    r: {
                        min: 0,
                        max: 5,
                        ticks: {
                            stepSize: 1,
                            backdropColor: 'transparent',
                            color: '#666'
                        },
                        pointLabels: {
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: '#333'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        document.getElementById("download-pdf").addEventListener("click", () => {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            const chartCanvas = document.getElementById("radar-chart");
            const chartImage = chartCanvas.toDataURL("image/png", 1.0);

            pdf.setFontSize(16);
            pdf.text("Résultats de votre évaluation UX", 10, 20);
            pdf.setFontSize(14);
            pdf.text(level.title, 10, 35);
            pdf.text(`Score global : ${globalScore}`, 10, 45);
            pdf.setFontSize(11);
            pdf.text(pdf.splitTextToSize(level.desc, 180), 10, 55);

            pdf.addImage(chartImage, "PNG", 10, 110, 180, 100);
            pdf.save("resultats-ux.pdf");
        });
    </script>
</body>
</html>
